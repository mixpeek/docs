---
title: "Sort Relevance"
description: "Reorder documents by their relevance scores from previous stages"
---

<Frame>
  <img src="/assets/retrievers/sort-relevance.svg" alt="Sort Relevance stage showing document reordering by relevance scores" />
</Frame>

The Sort Relevance stage reorders documents based on their relevance scores from previous stages. This is useful when documents have been modified or filtered and need to be re-sorted by their original search scores.

<Note>
  **Stage Category**: SORT (Reorders documents)

  **Transformation**: N documents â†’ N documents (reordered by relevance)
</Note>

## When to Use

| Use Case | Description |
|----------|-------------|
| **Post-filter sorting** | Re-sort after structured_filter removes documents |
| **Score normalization** | Apply consistent sorting after multi-stage processing |
| **Restoring order** | Return to relevance order after other sort operations |
| **Combining scores** | Sort by combined scores from multiple sources |

## When NOT to Use

| Scenario | Recommended Alternative |
|----------|------------------------|
| Sorting by metadata field | `sort_by_field` |
| Neural re-scoring | `rerank` |
| Results already sorted | Skip this stage |
| Diversifying results | `mmr` |

## Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `score_field` | string | `score` | Field containing relevance score |
| `order` | string | `desc` | Sort order: `desc` (highest first) or `asc` |
| `normalize` | boolean | `false` | Normalize scores to 0-1 range |

## Configuration Examples

<CodeGroup>
```json Basic Relevance Sort
{
  "stage_type": "sort",
  "stage_id": "sort_relevance",
  "parameters": {
    "order": "desc"
  }
}
```

```json Custom Score Field
{
  "stage_type": "sort",
  "stage_id": "sort_relevance",
  "parameters": {
    "score_field": "search_score",
    "order": "desc"
  }
}
```

```json Normalized Scores
{
  "stage_type": "sort",
  "stage_id": "sort_relevance",
  "parameters": {
    "score_field": "score",
    "order": "desc",
    "normalize": true
  }
}
```

```json Ascending Order
{
  "stage_type": "sort",
  "stage_id": "sort_relevance",
  "parameters": {
    "score_field": "distance",
    "order": "asc"
  }
}
```
</CodeGroup>

## How It Works

1. **Extract Scores**: Read the score field from each document
2. **Sort**: Order documents by score (descending by default)
3. **Optionally Normalize**: Scale scores to 0-1 range
4. **Return**: Documents in new order

## Output Schema

```json
{
  "document_id": "doc_123",
  "content": "Document content...",
  "score": 0.95,
  "sort_relevance": {
    "original_position": 3,
    "new_position": 1,
    "normalized_score": 1.0
  }
}
```

## Performance

| Metric | Value |
|--------|-------|
| **Latency** | < 5ms |
| **Memory** | O(N) |
| **Cost** | Free |
| **Complexity** | O(N log N) |

## Common Pipeline Patterns

### Search + Filter + Re-sort

```json
[
  {
    "stage_type": "filter",
    "stage_id": "semantic_search",
    "parameters": {
      "query": "{{INPUT.query}}",
      "vector_index": "text_extractor_v1_embedding",
      "top_k": 100
    }
  },
  {
    "stage_type": "filter",
    "stage_id": "structured_filter",
    "parameters": {
      "conditions": {
        "field": "metadata.status",
        "operator": "eq",
        "value": "published"
      }
    }
  },
  {
    "stage_type": "sort",
    "stage_id": "sort_relevance",
    "parameters": {
      "order": "desc"
    }
  }
]
```

### Multi-Stage with Score Normalization

```json
[
  {
    "stage_type": "filter",
    "stage_id": "hybrid_search",
    "parameters": {
      "query": "{{INPUT.query}}",
      "vector_index": "text_extractor_v1_embedding",
      "top_k": 50
    }
  },
  {
    "stage_type": "apply",
    "stage_id": "llm_enrichment",
    "parameters": {
      "model": "gpt-4o-mini",
      "prompt": "Extract key topics",
      "output_field": "topics"
    }
  },
  {
    "stage_type": "sort",
    "stage_id": "sort_relevance",
    "parameters": {
      "normalize": true
    }
  }
]
```

## Comparison with Other Sort Stages

| Stage | Purpose | Score Source |
|-------|---------|--------------|
| `sort_relevance` | Relevance scores | Search/fusion scores |
| `sort_by_field` | Metadata values | Any document field |
| `rerank` | Neural re-scoring | Cross-encoder model |
| `mmr` | Diversity | Relevance + diversity |

## Error Handling

| Error | Behavior |
|-------|----------|
| Missing score field | Use 0 as default |
| Non-numeric score | Move to end |
| Empty input | Return empty |
| Equal scores | Maintain original order |

## Related

- [Rerank](/retrieval/stages/rerank) - Neural re-scoring
- [Sort By Field](/retrieval/stages/sort-by-field) - Metadata sorting
- [MMR](/retrieval/stages/mmr) - Diversity-aware sorting
