---
title: "Semantic Search"
description: "Find documents by meaning using dense vector embeddings and cosine similarity"
---

<Frame>
  <img src="/assets/retrievers/semantic-search.svg" alt="Semantic search stage showing query embedding and vector similarity search" />
</Frame>

The Semantic Search stage finds documents by meaning using dense vector embeddings. It converts your query into a vector using the same embedding model used during indexing, then finds the most similar documents using approximate nearest neighbor (ANN) search.

<Note>
  **Stage Category**: FILTER (Reduces document set)

  **Transformation**: Collection → top_k documents (ranked by similarity)
</Note>

## When to Use

| Use Case | Description |
|----------|-------------|
| **Natural language search** | "wireless headphones with noise cancellation" |
| **Conceptual matching** | Find docs with similar meaning, not just keywords |
| **Cross-modal search** | Text query → find matching videos/images |
| **Multilingual search** | Query in one language, find docs in another |
| **RAG retrieval** | Retrieve context for LLM generation |

## When NOT to Use

| Scenario | Recommended Alternative |
|----------|------------------------|
| Exact phrase matching | `hybrid_search` with text weight |
| Keyword-heavy queries | `hybrid_search` or full-text search |
| Product SKUs/model numbers | `structured_filter` on exact fields |
| Very short queries (1-2 words) | `hybrid_search` for better recall |

## Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `query` | string | *Required* | Search query (supports templates like `{{INPUT.query}}`) |
| `vector_index` | string | *Required* | Name of the vector index to search |
| `top_k` | integer | `100` | Number of candidates to retrieve |
| `min_score` | float | `0.0` | Minimum similarity score threshold (0.0-1.0) |
| `filters` | object | `null` | Pre-filter conditions (applied before vector search) |

## Vector Index Selection

The `vector_index` must match an index created by a feature extractor:

| Feature Extractor | Index Name | Dimensions |
|-------------------|------------|------------|
| `text_extractor_v1` | `text_extractor_v1_embedding` | 1024 |
| `multimodal_extractor_v1` | `multimodal_extractor_v1_multimodal_embedding` | 1408 |
| `multimodal_extractor_v1` | `multimodal_extractor_v1_transcription_embedding` | 1024 |

## Configuration Examples

<CodeGroup>
```json Basic Text Search
{
  "stage_type": "filter",
  "stage_id": "semantic_search",
  "parameters": {
    "query": "{{INPUT.query}}",
    "vector_index": "text_extractor_v1_embedding",
    "top_k": 100
  }
}
```

```json With Minimum Score
{
  "stage_type": "filter",
  "stage_id": "semantic_search",
  "parameters": {
    "query": "{{INPUT.query}}",
    "vector_index": "text_extractor_v1_embedding",
    "top_k": 50,
    "min_score": 0.7
  }
}
```

```json With Pre-Filter
{
  "stage_type": "filter",
  "stage_id": "semantic_search",
  "parameters": {
    "query": "{{INPUT.query}}",
    "vector_index": "text_extractor_v1_embedding",
    "top_k": 100,
    "filters": {
      "AND": [
        {"field": "metadata.category", "operator": "eq", "value": "electronics"},
        {"field": "metadata.in_stock", "operator": "eq", "value": true}
      ]
    }
  }
}
```

```json Multimodal Search (Text to Video)
{
  "stage_type": "filter",
  "stage_id": "semantic_search",
  "parameters": {
    "query": "person explaining machine learning concepts",
    "vector_index": "multimodal_extractor_v1_multimodal_embedding",
    "top_k": 20
  }
}
```

```json Dynamic Query from Input
{
  "stage_type": "filter",
  "stage_id": "semantic_search",
  "parameters": {
    "query": "{{INPUT.search_text}} in {{INPUT.category}}",
    "vector_index": "text_extractor_v1_embedding",
    "top_k": "{{INPUT.limit | default(50)}}"
  }
}
```
</CodeGroup>

## How It Works

1. **Query Embedding**: Your query is converted to a vector using the same model that indexed the documents
2. **ANN Search**: Approximate nearest neighbor search finds the top_k most similar vectors
3. **Score Calculation**: Cosine similarity is computed (0.0 = orthogonal, 1.0 = identical)
4. **Filtering**: Optional pre-filters are applied to narrow the search space
5. **Ranking**: Results are returned sorted by similarity score (highest first)

## Output

Each returned document includes:

| Field | Type | Description |
|-------|------|-------------|
| `document_id` | string | Unique document identifier |
| `score` | float | Similarity score (0.0-1.0) |
| `content` | string | Document content |
| `metadata` | object | Document metadata |

## Performance

| Metric | Value |
|--------|-------|
| **Latency** | 5-50ms for millions of vectors |
| **top_k range** | 1-10,000 |
| **Index type** | HNSW (Hierarchical Navigable Small World) |
| **Distance metric** | Cosine similarity |

<Tip>
  Use larger `top_k` values (100-500) when planning to rerank results with the `rerank` stage. The reranker will select the best final results from this candidate pool.
</Tip>

## Pre-Filtering

Pre-filters are applied **before** vector search, using indexed metadata fields:

```json
{
  "filters": {
    "AND": [
      {"field": "metadata.status", "operator": "eq", "value": "published"},
      {"field": "metadata.date", "operator": "gte", "value": "2024-01-01"}
    ]
  }
}
```

Supported operators: `eq`, `ne`, `gt`, `lt`, `gte`, `lte`, `in`, `nin`, `contains`, `exists`

## Common Pipeline Patterns

### Two-Stage Retrieval (Retrieve + Rerank)

```json
[
  {
    "stage_type": "filter",
    "stage_id": "semantic_search",
    "parameters": {
      "query": "{{INPUT.query}}",
      "vector_index": "text_extractor_v1_embedding",
      "top_k": 100
    }
  },
  {
    "stage_type": "sort",
    "stage_id": "rerank",
    "parameters": {
      "model": "bge-reranker-v2-m3",
      "top_n": 10
    }
  }
]
```

### Semantic Search + Structured Filter

```json
[
  {
    "stage_type": "filter",
    "stage_id": "semantic_search",
    "parameters": {
      "query": "{{INPUT.query}}",
      "vector_index": "text_extractor_v1_embedding",
      "top_k": 200
    }
  },
  {
    "stage_type": "filter",
    "stage_id": "structured_filter",
    "parameters": {
      "conditions": {
        "field": "metadata.price",
        "operator": "lte",
        "value": "{{INPUT.max_price}}"
      }
    }
  }
]
```

## Related

- [Hybrid Search](/retrieval/stages/hybrid-search) - Combine semantic + full-text search
- [Rerank](/retrieval/stages/rerank) - Re-score results with cross-encoder
- [Structured Filter](/retrieval/stages/structured-filter) - Metadata filtering
- [Feature Extractors](/processing/feature-extractors) - How documents are indexed
