---
title: "Limit"
description: "Control the number of documents returned from the pipeline"
---

<Frame>
  <img src="/assets/retrievers/limit.svg" alt="Limit stage showing result count control" />
</Frame>

The Limit stage controls the number of documents returned from the pipeline. It simply takes the first N documents from the current result set, preserving their order.

<Note>
  **Stage Category**: REDUCE (Reduces document count)

  **Transformation**: N documents â†’ min(N, limit) documents
</Note>

## When to Use

| Use Case | Description |
|----------|-------------|
| **Final result count** | Return top 10 results to user |
| **Pre-processing reduction** | Limit before expensive operations |
| **Pagination** | Control page sizes |
| **Resource management** | Prevent large result sets |

## When NOT to Use

| Scenario | Recommended Alternative |
|----------|------------------------|
| Want best results | Use `rerank` first |
| Need offset pagination | Combine with offset logic |
| Filtering by criteria | Use `structured_filter` |

## Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `limit` | integer | *Required* | Maximum number of documents to return |

## Configuration Examples

<CodeGroup>
```json Simple Top 10
{
  "stage_type": "reduce",
  "stage_id": "limit",
  "parameters": {
    "limit": 10
  }
}
```

```json Top 5 Results
{
  "stage_type": "reduce",
  "stage_id": "limit",
  "parameters": {
    "limit": 5
  }
}
```

```json Dynamic Limit
{
  "stage_type": "reduce",
  "stage_id": "limit",
  "parameters": {
    "limit": "{{INPUT.page_size}}"
  }
}
```

```json Large Result Set
{
  "stage_type": "reduce",
  "stage_id": "limit",
  "parameters": {
    "limit": 100
  }
}
```
</CodeGroup>

## Output

The stage returns the first N documents in their current order:

**Input** (5 documents):
```json
[
  {"document_id": "doc_1", "score": 0.95},
  {"document_id": "doc_2", "score": 0.90},
  {"document_id": "doc_3", "score": 0.85},
  {"document_id": "doc_4", "score": 0.80},
  {"document_id": "doc_5", "score": 0.75}
]
```

**Output** (limit: 3):
```json
[
  {"document_id": "doc_1", "score": 0.95},
  {"document_id": "doc_2", "score": 0.90},
  {"document_id": "doc_3", "score": 0.85}
]
```

## Performance

| Metric | Value |
|--------|-------|
| **Latency** | < 1ms |
| **Complexity** | O(1) |
| **Memory** | Minimal |

<Tip>
  Limit is essentially free. Use it liberally to control result sizes and reduce processing in downstream stages.
</Tip>

## Common Pipeline Patterns

### Search + Rerank + Limit

```json
[
  {
    "stage_type": "filter",
    "stage_id": "semantic_search",
    "parameters": {
      "query": "{{INPUT.query}}",
      "vector_index": "text_extractor_v1_embedding",
      "top_k": 100
    }
  },
  {
    "stage_type": "sort",
    "stage_id": "rerank",
    "parameters": {
      "model": "bge-reranker-v2-m3",
      "top_n": 20
    }
  },
  {
    "stage_type": "reduce",
    "stage_id": "limit",
    "parameters": {
      "limit": 5
    }
  }
]
```

### Limit Before Expensive Operations

```json
[
  {
    "stage_type": "filter",
    "stage_id": "hybrid_search",
    "parameters": {
      "query": "{{INPUT.query}}",
      "vector_index": "text_extractor_v1_embedding",
      "top_k": 200
    }
  },
  {
    "stage_type": "reduce",
    "stage_id": "limit",
    "parameters": {
      "limit": 50
    }
  },
  {
    "stage_type": "apply",
    "stage_id": "llm_enrichment",
    "parameters": {
      "model": "gpt-4o-mini",
      "prompt": "Extract key entities"
    }
  }
]
```

### Full RAG Pipeline

```json
[
  {
    "stage_type": "filter",
    "stage_id": "hybrid_search",
    "parameters": {
      "query": "{{INPUT.query}}",
      "vector_index": "text_extractor_v1_embedding",
      "top_k": 50
    }
  },
  {
    "stage_type": "sort",
    "stage_id": "rerank",
    "parameters": {
      "model": "bge-reranker-v2-m3",
      "top_n": 15
    }
  },
  {
    "stage_type": "reduce",
    "stage_id": "limit",
    "parameters": {
      "limit": 10
    }
  },
  {
    "stage_type": "apply",
    "stage_id": "rag_prepare",
    "parameters": {
      "max_tokens": 8000,
      "output_mode": "single_context"
    }
  }
]
```

### Progressive Reduction

```json
[
  {
    "stage_type": "filter",
    "stage_id": "semantic_search",
    "parameters": {
      "top_k": 500
    }
  },
  {
    "stage_type": "filter",
    "stage_id": "structured_filter",
    "parameters": {
      "conditions": {"field": "status", "operator": "eq", "value": "active"}
    }
  },
  {
    "stage_type": "reduce",
    "stage_id": "limit",
    "parameters": {
      "limit": 100
    }
  },
  {
    "stage_type": "sort",
    "stage_id": "rerank",
    "parameters": {
      "model": "bge-reranker-v2-m3",
      "top_n": 20
    }
  },
  {
    "stage_type": "reduce",
    "stage_id": "limit",
    "parameters": {
      "limit": 5
    }
  }
]
```

## Limit vs top_k vs top_n

| Parameter | Stage | Description |
|-----------|-------|-------------|
| `top_k` | Search stages | Initial retrieval limit |
| `top_n` | Rerank | Results after reranking |
| `limit` | Limit stage | Final output control |

**Recommendation**: Use generous `top_k` for recall, `top_n` for precision, and `limit` for final output size.

## Error Handling

| Scenario | Behavior |
|----------|----------|
| Limit > document count | Returns all documents |
| Limit = 0 | Returns empty set |
| Limit < 0 | Error |
| Missing limit | Error |

## Related

- [Rerank](/retrieval/stages/rerank) - Quality-based selection
- [Deduplicate](/retrieval/stages/deduplicate) - Remove duplicates
- [Sort By Field](/retrieval/stages/sort-by-field) - Order before limiting
