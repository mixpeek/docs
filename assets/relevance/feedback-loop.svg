<svg viewBox="0 0 1200 500" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="searchGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#6366f1;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4f46e5;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="resultGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f97316;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ea580c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="interactGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="learnGradFB" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ec4899;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#db2777;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="measureGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
    </linearGradient>
    
    <marker id="arrowFB" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#94a3b8"/>
    </marker>
    <marker id="arrowLoop" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ec4899"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1200" height="500" fill="none"/>

  <!-- Title -->
  <text x="600" y="40" font-family="system-ui, -apple-system, sans-serif" font-size="24" font-weight="600" fill="#f1f5f9" text-anchor="middle">The Relevance Feedback Loop</text>
  <text x="600" y="65" font-family="system-ui, sans-serif" font-size="13" fill="#94a3b8" text-anchor="middle">Search results improve automatically as users interact with your application</text>

  <!-- Step 1: Search -->
  <g>
    <rect x="60" y="120" width="190" height="110" rx="12" fill="white" stroke="#334155" stroke-width="2"/>
    <rect x="60" y="120" width="190" height="32" rx="12" fill="url(#searchGrad)"/>
    <rect x="60" y="140" width="190" height="12" fill="url(#searchGrad)"/>
    <text x="155" y="143" font-family="system-ui, sans-serif" font-size="13" font-weight="600" fill="white" text-anchor="middle">1. Search</text>
    <text x="155" y="172" font-family="system-ui, sans-serif" font-size="11" fill="#475569" text-anchor="middle">User submits a query</text>
    <text x="155" y="190" font-family="system-ui, sans-serif" font-size="11" fill="#475569" text-anchor="middle">Retriever executes stages</text>
    <text x="155" y="208" font-family="system-ui, sans-serif" font-size="10" fill="#94a3b8" text-anchor="middle">feature_search + fusion</text>
  </g>

  <!-- Arrow 1→2 -->
  <line x1="250" y1="175" x2="300" y2="175" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrowFB)"/>

  <!-- Step 2: Results -->
  <g>
    <rect x="310" y="120" width="190" height="110" rx="12" fill="white" stroke="#334155" stroke-width="2"/>
    <rect x="310" y="120" width="190" height="32" rx="12" fill="url(#resultGrad)"/>
    <rect x="310" y="140" width="190" height="12" fill="url(#resultGrad)"/>
    <text x="405" y="143" font-family="system-ui, sans-serif" font-size="13" font-weight="600" fill="white" text-anchor="middle">2. Results</text>
    <text x="405" y="172" font-family="system-ui, sans-serif" font-size="11" fill="#475569" text-anchor="middle">Ranked documents returned</text>
    <text x="405" y="190" font-family="system-ui, sans-serif" font-size="11" fill="#475569" text-anchor="middle">Fused from multiple features</text>
    <text x="405" y="208" font-family="system-ui, sans-serif" font-size="10" fill="#94a3b8" text-anchor="middle">with scores and metadata</text>
  </g>

  <!-- Arrow 2→3 -->
  <line x1="500" y1="175" x2="550" y2="175" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrowFB)"/>

  <!-- Step 3: Interact -->
  <g>
    <rect x="560" y="120" width="190" height="110" rx="12" fill="white" stroke="#334155" stroke-width="2"/>
    <rect x="560" y="120" width="190" height="32" rx="12" fill="url(#interactGrad)"/>
    <rect x="560" y="140" width="190" height="12" fill="url(#interactGrad)"/>
    <text x="655" y="143" font-family="system-ui, sans-serif" font-size="13" font-weight="600" fill="white" text-anchor="middle">3. Interact</text>
    <text x="655" y="172" font-family="system-ui, sans-serif" font-size="11" fill="#475569" text-anchor="middle">Users click, purchase, skip</text>
    <text x="655" y="190" font-family="system-ui, sans-serif" font-size="11" fill="#475569" text-anchor="middle">Signals captured via API</text>
    <text x="655" y="208" font-family="system-ui, sans-serif" font-size="10" fill="#94a3b8" text-anchor="middle">click, view, purchase, skip</text>
  </g>

  <!-- Arrow 3→4 -->
  <line x1="750" y1="175" x2="800" y2="175" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrowFB)"/>

  <!-- Step 4: Learn -->
  <g>
    <rect x="810" y="120" width="190" height="110" rx="12" fill="white" stroke="#334155" stroke-width="2"/>
    <rect x="810" y="120" width="190" height="32" rx="12" fill="url(#learnGradFB)"/>
    <rect x="810" y="140" width="190" height="12" fill="url(#learnGradFB)"/>
    <text x="905" y="143" font-family="system-ui, sans-serif" font-size="13" font-weight="600" fill="white" text-anchor="middle">4. Learn</text>
    <text x="905" y="172" font-family="system-ui, sans-serif" font-size="11" fill="#475569" text-anchor="middle">Thompson Sampling updates</text>
    <text x="905" y="190" font-family="system-ui, sans-serif" font-size="11" fill="#475569" text-anchor="middle">Beta distributions evolve</text>
    <text x="905" y="208" font-family="system-ui, sans-serif" font-size="10" fill="#94a3b8" text-anchor="middle">personal → demographic → global</text>
  </g>

  <!-- Arrow 4→5 (down) -->
  <line x1="905" y1="230" x2="905" y2="280" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrowFB)"/>

  <!-- Step 5: Measure -->
  <g>
    <rect x="810" y="290" width="190" height="110" rx="12" fill="white" stroke="#334155" stroke-width="2"/>
    <rect x="810" y="290" width="190" height="32" rx="12" fill="url(#measureGrad)"/>
    <rect x="810" y="310" width="190" height="12" fill="url(#measureGrad)"/>
    <text x="905" y="313" font-family="system-ui, sans-serif" font-size="13" font-weight="600" fill="white" text-anchor="middle">5. Measure</text>
    <text x="905" y="342" font-family="system-ui, sans-serif" font-size="11" fill="#475569" text-anchor="middle">Evaluate with NDCG, MAP</text>
    <text x="905" y="360" font-family="system-ui, sans-serif" font-size="11" fill="#475569" text-anchor="middle">Monitor analytics dashboard</text>
    <text x="905" y="378" font-family="system-ui, sans-serif" font-size="10" fill="#94a3b8" text-anchor="middle">benchmarks + slow queries</text>
  </g>

  <!-- Feedback loop arrow (curved, back to Search) -->
  <path d="M 810 345 Q 500 440 155 240" stroke="#ec4899" stroke-width="2.5" fill="none" stroke-dasharray="8,4" marker-end="url(#arrowLoop)"/>

  <!-- Feedback loop label -->
  <g transform="translate(400, 380)">
    <rect x="0" y="0" width="220" height="44" rx="8" fill="#fdf2f8" stroke="#ec4899" stroke-width="1.5"/>
    <text x="110" y="18" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#db2777" text-anchor="middle">Continuous Improvement</text>
    <text x="110" y="35" font-family="system-ui, sans-serif" font-size="10" fill="#9d174d" text-anchor="middle">Better fusion weights → better results</text>
  </g>

  <!-- Legend -->
  <g transform="translate(60, 460)">
    <rect width="12" height="12" rx="2" fill="url(#searchGrad)"/>
    <text x="20" y="11" font-family="system-ui, sans-serif" font-size="11" fill="#475569">Search</text>

    <rect x="90" width="12" height="12" rx="2" fill="url(#resultGrad)"/>
    <text x="110" y="11" font-family="system-ui, sans-serif" font-size="11" fill="#475569">Results</text>

    <rect x="180" width="12" height="12" rx="2" fill="url(#interactGrad)"/>
    <text x="200" y="11" font-family="system-ui, sans-serif" font-size="11" fill="#475569">Interact</text>

    <rect x="280" width="12" height="12" rx="2" fill="url(#learnGradFB)"/>
    <text x="300" y="11" font-family="system-ui, sans-serif" font-size="11" fill="#475569">Learn</text>

    <rect x="360" width="12" height="12" rx="2" fill="url(#measureGrad)"/>
    <text x="380" y="11" font-family="system-ui, sans-serif" font-size="11" fill="#475569">Measure</text>

    <line x1="450" y1="6" x2="490" y2="6" stroke="#ec4899" stroke-width="2" stroke-dasharray="6,3"/>
    <text x="500" y="11" font-family="system-ui, sans-serif" font-size="11" fill="#475569">Feedback Loop</text>
  </g>
</svg>