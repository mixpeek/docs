<svg viewBox="0 0 900 380" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="queryGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#6366f1;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4f46e5;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="vectorGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="textGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f97316;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ea580c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="fusionGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ec4899;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#db2777;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="outputGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#14b8a6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#0d9488;stop-opacity:1" />
    </linearGradient>
    
    <marker id="arrowGray" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#94a3b8"/>
    </marker>
  </defs>

  <rect width="900" height="380" fill="none"/>

  <text x="450" y="28" font-family="system-ui, -apple-system, sans-serif" font-size="16" font-weight="600" fill="#f1f5f9" text-anchor="middle">Hybrid Search Stage: Vector + Full-Text Fusion</text>
  <text x="450" y="46" font-family="system-ui, sans-serif" font-size="10" fill="#94a3b8" text-anchor="middle">Combine semantic and lexical search with RRF (Reciprocal Rank Fusion)</text>

  <!-- Query Input -->
  <g>
    <rect x="20" y="70" width="140" height="90" rx="8" fill="white" stroke="#334155" stroke-width="1"/>
    <rect x="20" y="70" width="140" height="26" rx="8" fill="url(#queryGrad)"/>
    <rect x="20" y="88" width="140" height="8" fill="url(#queryGrad)"/>
    <text x="90" y="88" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">Query Input</text>
  </g>
  <g transform="translate(28, 105)">
    <rect x="0" y="0" width="124" height="45" rx="4" fill="#eef2ff"/>
    <text x="62" y="18" font-family="monospace" font-size="8" fill="#4338ca" text-anchor="middle">query:</text>
    <text x="62" y="34" font-family="system-ui, sans-serif" font-size="7" fill="#94a3b8" text-anchor="middle">"iPhone 15 Pro Max"</text>
  </g>

  <!-- Branch arrows -->
  <path d="M 160 115 L 190 115 L 190 95 L 220 95" stroke="#94a3b8" stroke-width="2" fill="none" marker-end="url(#arrowGray)"/>
  <path d="M 160 115 L 190 115 L 190 195 L 220 195" stroke="#94a3b8" stroke-width="2" fill="none" marker-end="url(#arrowGray)"/>

  <!-- Semantic Search Branch -->
  <g>
    <rect x="230" y="60" width="170" height="90" rx="8" fill="white" stroke="#334155" stroke-width="1"/>
    <rect x="230" y="60" width="170" height="26" rx="8" fill="url(#vectorGrad)"/>
    <rect x="230" y="78" width="170" height="8" fill="url(#vectorGrad)"/>
    <text x="315" y="78" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">Semantic Search</text>
  </g>
  <g transform="translate(238, 95)">
    <rect x="0" y="0" width="154" height="45" rx="4" fill="#f3e8ff"/>
    <text x="77" y="16" font-family="system-ui, sans-serif" font-size="8" font-weight="500" fill="#7c3aed" text-anchor="middle">Vector Similarity</text>
    <text x="77" y="32" font-family="system-ui, sans-serif" font-size="7" fill="#475569" text-anchor="middle">Meaning-based matching</text>
  </g>

  <!-- Full-Text Search Branch -->
  <g>
    <rect x="230" y="160" width="170" height="90" rx="8" fill="white" stroke="#334155" stroke-width="1"/>
    <rect x="230" y="160" width="170" height="26" rx="8" fill="url(#textGrad)"/>
    <rect x="230" y="178" width="170" height="8" fill="url(#textGrad)"/>
    <text x="315" y="178" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">Full-Text Search</text>
  </g>
  <g transform="translate(238, 195)">
    <rect x="0" y="0" width="154" height="45" rx="4" fill="#fff7ed"/>
    <text x="77" y="16" font-family="system-ui, sans-serif" font-size="8" font-weight="500" fill="#ea580c" text-anchor="middle">BM25 / Keyword Match</text>
    <text x="77" y="32" font-family="system-ui, sans-serif" font-size="7" fill="#475569" text-anchor="middle">Exact term matching</text>
  </g>

  <!-- Merge arrows -->
  <path d="M 400 105 L 430 105 L 430 145 L 460 145" stroke="#94a3b8" stroke-width="2" fill="none" marker-end="url(#arrowGray)"/>
  <path d="M 400 205 L 430 205 L 430 145 L 460 145" stroke="#94a3b8" stroke-width="2" fill="none" marker-end="url(#arrowGray)"/>

  <!-- Fusion -->
  <g>
    <rect x="470" y="70" width="170" height="150" rx="8" fill="white" stroke="#334155" stroke-width="1"/>
    <rect x="470" y="70" width="170" height="26" rx="8" fill="url(#fusionGrad)"/>
    <rect x="470" y="88" width="170" height="8" fill="url(#fusionGrad)"/>
    <text x="555" y="88" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">Rank Fusion (RRF)</text>
  </g>
  <g transform="translate(478, 105)">
    <rect x="0" y="0" width="154" height="105" rx="4" fill="#fce7f3"/>
    <text x="77" y="18" font-family="monospace" font-size="8" fill="#db2777" text-anchor="middle">score = 1/(k + rank)</text>
    <text x="77" y="40" font-family="system-ui, sans-serif" font-size="8" fill="#475569" text-anchor="middle">Configurable weights:</text>
    <text x="77" y="58" font-family="monospace" font-size="7" fill="#7c3aed" text-anchor="middle">vector_weight: 0.7</text>
    <text x="77" y="74" font-family="monospace" font-size="7" fill="#ea580c" text-anchor="middle">text_weight: 0.3</text>
    <text x="77" y="96" font-family="system-ui, sans-serif" font-size="7" fill="#94a3b8" text-anchor="middle">Merges and re-ranks results</text>
  </g>

  <path d="M 640 145 L 680 145" stroke="#94a3b8" stroke-width="2" fill="none" marker-end="url(#arrowGray)"/>

  <!-- Output -->
  <g>
    <rect x="690" y="70" width="170" height="150" rx="8" fill="white" stroke="#334155" stroke-width="1"/>
    <rect x="690" y="70" width="170" height="26" rx="8" fill="url(#outputGrad)"/>
    <rect x="690" y="88" width="170" height="8" fill="url(#outputGrad)"/>
    <text x="775" y="88" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="white" text-anchor="middle">Fused Results</text>
  </g>
  <g transform="translate(698, 105)">
    <rect x="0" y="0" width="154" height="105" rx="4" fill="#ccfbf1"/>
    <text x="77" y="16" font-family="system-ui, sans-serif" font-size="8" font-weight="500" fill="#0d9488" text-anchor="middle">Best of Both</text>
    <rect x="8" y="24" width="138" height="20" rx="3" fill="#a7f3d0"/>
    <text x="77" y="38" font-family="monospace" font-size="7" fill="#0d9488" text-anchor="middle">[1] exact + semantic</text>
    <rect x="8" y="48" width="138" height="20" rx="3" fill="#bbf7d0"/>
    <text x="77" y="62" font-family="monospace" font-size="7" fill="#16a34a" text-anchor="middle">[2] high relevance</text>
    <rect x="8" y="72" width="138" height="20" rx="3" fill="#dcfce7"/>
    <text x="77" y="86" font-family="monospace" font-size="7" fill="#22c55e" text-anchor="middle">[3] semantic only</text>
  </g>

  <!-- Use Cases -->
  <g transform="translate(30, 270)">
    <rect x="0" y="0" width="840" height="85" rx="6" fill="#eff6ff" stroke="#93c5fd" stroke-width="1"/>
    <text x="420" y="20" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#2563eb" text-anchor="middle">When to Use Hybrid Search</text>

    <rect x="20" y="35" width="250" height="40" rx="4" fill="#f3e8ff"/>
    <text x="145" y="52" font-family="system-ui, sans-serif" font-size="8" font-weight="500" fill="#7c3aed" text-anchor="middle">Product/SKU Search</text>
    <text x="145" y="66" font-family="system-ui, sans-serif" font-size="7" fill="#94a3b8" text-anchor="middle">Exact model numbers + descriptions</text>

    <rect x="290" y="35" width="250" height="40" rx="4" fill="#fff7ed"/>
    <text x="415" y="52" font-family="system-ui, sans-serif" font-size="8" font-weight="500" fill="#ea580c" text-anchor="middle">Technical Documentation</text>
    <text x="415" y="66" font-family="system-ui, sans-serif" font-size="7" fill="#94a3b8" text-anchor="middle">Function names + concepts</text>

    <rect x="560" y="35" width="260" height="40" rx="4" fill="#dcfce7"/>
    <text x="690" y="52" font-family="system-ui, sans-serif" font-size="8" font-weight="500" fill="#16a34a" text-anchor="middle">Mixed Queries</text>
    <text x="690" y="66" font-family="system-ui, sans-serif" font-size="7" fill="#94a3b8" text-anchor="middle">Better recall than either alone</text>
  </g>
</svg>
