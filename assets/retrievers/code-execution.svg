<svg viewBox="0 0 900 350" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="inputGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2563eb;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="codeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1e293b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#0f172a;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="outputGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#14b8a6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#0d9488;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-opacity="0.15"/>
    </filter>
    <marker id="arrowGray" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#94a3b8"/>
    </marker>
  </defs>

  <rect width="900" height="350" fill="#f8fafc"/>

  <text x="450" y="30" font-family="system-ui, -apple-system, sans-serif" font-size="18" font-weight="600" fill="#0f172a" text-anchor="middle">Code Execution: Custom Processing Logic</text>
  <text x="450" y="50" font-family="system-ui, sans-serif" font-size="11" fill="#64748b" text-anchor="middle">Execute custom Python/JavaScript code to transform, filter, or enrich documents</text>

  <!-- Input -->
  <g filter="url(#shadow)">
    <rect x="30" y="80" width="180" height="140" rx="10" fill="white" stroke="#e2e8f0" stroke-width="2"/>
    <rect x="30" y="80" width="180" height="28" rx="10" fill="url(#inputGrad)"/>
    <rect x="30" y="98" width="180" height="10" fill="url(#inputGrad)"/>
    <text x="120" y="100" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white" text-anchor="middle">Documents</text>
  </g>
  <g transform="translate(40, 120)">
    <rect x="0" y="0" width="160" height="28" rx="3" fill="#eff6ff"/>
    <text x="80" y="18" font-family="monospace" font-size="8" fill="#475569" text-anchor="middle">doc.price = 29.99</text>
    <rect x="0" y="34" width="160" height="28" rx="3" fill="#eff6ff"/>
    <text x="80" y="52" font-family="monospace" font-size="8" fill="#475569" text-anchor="middle">doc.quantity = 5</text>
    <rect x="0" y="68" width="160" height="28" rx="3" fill="#eff6ff"/>
    <text x="80" y="86" font-family="monospace" font-size="8" fill="#475569" text-anchor="middle">doc.discount = 0.1</text>
  </g>

  <path d="M 210 150 L 250 150" stroke="#94a3b8" stroke-width="2" fill="none" marker-end="url(#arrowGray)"/>

  <!-- Code Execution -->
  <g filter="url(#shadow)">
    <rect x="260" y="70" width="320" height="180" rx="10" fill="white" stroke="#e2e8f0" stroke-width="2"/>
    <rect x="260" y="70" width="320" height="28" rx="10" fill="url(#codeGrad)"/>
    <rect x="260" y="88" width="320" height="10" fill="url(#codeGrad)"/>
    <text x="420" y="90" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white" text-anchor="middle">Sandboxed Code Execution</text>
  </g>
  <g transform="translate(270, 110)">
    <rect x="0" y="0" width="300" height="70" rx="4" fill="#1e293b"/>
    <text x="10" y="18" font-family="monospace" font-size="8" fill="#22d3ee">def</text>
    <text x="30" y="18" font-family="monospace" font-size="8" fill="#a5f3fc">process</text>
    <text x="68" y="18" font-family="monospace" font-size="8" fill="#f8fafc">(doc):</text>
    <text x="20" y="34" font-family="monospace" font-size="8" fill="#f8fafc">total = doc.price * doc.quantity</text>
    <text x="20" y="50" font-family="monospace" font-size="8" fill="#f8fafc">doc.final = total * (1 - doc.discount)</text>
    <text x="20" y="66" font-family="monospace" font-size="8" fill="#c084fc">return</text>
    <text x="55" y="66" font-family="monospace" font-size="8" fill="#f8fafc">doc</text>

    <rect x="0" y="80" width="145" height="28" rx="3" fill="#374151"/>
    <text x="72" y="98" font-family="monospace" font-size="8" fill="#22d3ee" text-anchor="middle">runtime: python</text>

    <rect x="155" y="80" width="145" height="28" rx="3" fill="#374151"/>
    <text x="227" y="98" font-family="monospace" font-size="8" fill="#22d3ee" text-anchor="middle">timeout: 5000ms</text>

    <rect x="0" y="115" width="300" height="25" rx="3" fill="#fef3c7"/>
    <text x="150" y="132" font-family="system-ui, sans-serif" font-size="8" fill="#d97706" text-anchor="middle">Sandboxed: No network, limited memory, safe execution</text>
  </g>

  <path d="M 580 150 L 620 150" stroke="#94a3b8" stroke-width="2" fill="none" marker-end="url(#arrowGray)"/>

  <!-- Output -->
  <g filter="url(#shadow)">
    <rect x="630" y="80" width="180" height="140" rx="10" fill="white" stroke="#e2e8f0" stroke-width="2"/>
    <rect x="630" y="80" width="180" height="28" rx="10" fill="url(#outputGrad)"/>
    <rect x="630" y="98" width="180" height="10" fill="url(#outputGrad)"/>
    <text x="720" y="100" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="white" text-anchor="middle">Transformed</text>
  </g>
  <g transform="translate(640, 120)">
    <rect x="0" y="0" width="160" height="28" rx="3" fill="#ccfbf1"/>
    <text x="80" y="18" font-family="monospace" font-size="8" fill="#0d9488" text-anchor="middle">doc.price = 29.99</text>
    <rect x="0" y="34" width="160" height="28" rx="3" fill="#d1fae5"/>
    <text x="80" y="52" font-family="monospace" font-size="8" fill="#16a34a" text-anchor="middle">doc.quantity = 5</text>
    <rect x="0" y="68" width="160" height="28" rx="3" fill="#a7f3d0"/>
    <text x="80" y="86" font-family="monospace" font-size="8" fill="#059669" text-anchor="middle">doc.final = 134.96</text>
  </g>

  <!-- Runtimes -->
  <g transform="translate(830, 100)">
    <rect x="0" y="0" width="60" height="70" rx="6" fill="#1e293b"/>
    <text x="30" y="18" font-family="system-ui, sans-serif" font-size="7" font-weight="600" fill="#22d3ee" text-anchor="middle">Runtimes</text>
    <text x="30" y="36" font-family="monospace" font-size="7" fill="#f8fafc" text-anchor="middle">Python</text>
    <text x="30" y="52" font-family="monospace" font-size="7" fill="#f8fafc" text-anchor="middle">JavaScript</text>
  </g>

  <!-- Info -->
  <g transform="translate(30, 280)">
    <rect x="0" y="0" width="400" height="50" rx="6" fill="#1e293b"/>
    <text x="200" y="20" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#22d3ee" text-anchor="middle">Use cases: Custom transformations, calculations, complex filtering</text>
    <text x="200" y="38" font-family="system-ui, sans-serif" font-size="9" fill="#94a3b8" text-anchor="middle">Business logic that can't be expressed with built-in stages</text>

    <rect x="420" y="0" width="350" height="50" rx="6" fill="#fef2f2"/>
    <text x="595" y="20" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#dc2626" text-anchor="middle">Latency: 10-100ms | Security: Sandboxed</text>
    <text x="595" y="38" font-family="system-ui, sans-serif" font-size="9" fill="#dc2626" text-anchor="middle">Use sparingly - adds overhead per document</text>
  </g>
</svg>
