import { Page } from 'puppeteer';

export default async function openNestedGitbookMenus(page: Page) {
  let clickedAny = true;

  // Loop until we've encountered every closed menu
  while (clickedAny) {
    clickedAny = await page.evaluate(() => {
      let clicked = false;
      // Right pointing arrow. Only menus have this icon
      const icons = document.querySelectorAll(
        'div > a > span > svg[style*="mask-image:url(https://ka-p.fontawesome.com/releases/v6.6.0/svgs/regular/chevron-right.svg?v=1&token=a463935e93)"]'
      );

      icons.forEach((icon) => {
        const span = icon.parentElement;
        if (span && span.className.includes('rotate-0')) {
          span.click();
          clicked = true;
        }
      });
      return clicked;
    });
  }

  return await page.content();
}
